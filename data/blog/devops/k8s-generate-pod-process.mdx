---
date: "2023-08-02"
title: 쿠버네티스 파드 생성 과정
tags: ["kubernetes"]
draft: false
summary: "쿠버네티스의 파드 생성 과정을 알아보자"
---

쿠버네티스는 MSA를 집약적으로 지원하는 플랫폼으로 각 구성요소가 전통적인 요청-응답 방식이 아닌 각자의 역할에만 충실하는 형태로 구성되어 있습니다.
그 중 기본 오브젝트인 파드가 생성되는 과정에서 각각의 구성요소가 어떤 행위를 하는지 알아보도록 하겠습니다.

1. 사용자는 kubectl 을 통해 API 서버에 파드생성을 요청
2. API 서버는 해당 요청을 검증하고 유효하다면 etcd에 저장
3. 컨트롤러 매니저는 주기적으로 API 서버를 통해 상태변화를 감지하고 변경을 감지하면 필요한 작업을 API서버를 통해 etcd에 저장
4. 스케줄러도 주기적으로 API서버를 통해 상태변화을 감지하고 변경을 감지하면 새로운 파드를 실행할 적합한 노드를 선택 후 API 서버를 통해 etcd에 저장
5. kubelet도 API 서버를 통해 새로운 파드 배치를 감지하고 해당 노드에서 파드를 실행
   <br />
   ![generate-pod](/static/images/k8s-generate-pod-process/k8s-generate-pod.jpg)

다이어그램에서는 누락되어 있지만 kubelet도 파드의 명세를 받아서 컨테이너 런타임(docker, containerd, ..)에게 컨테이너 생성 및 실행을 위임하는 형태입니다.
(많은 부분이 누락되어 있긴 합니다 ..a)

결론적으로 각 구성요소가 하는 업무는 아래와 같습니다.

### kubectl

쿠버네티스 클러스터와 상호작용하기 위한 커맨드라인 인터페이스로써 클러스터의 상태를 조회하거나, 생성, 변경등의 작업을 수행하기 위해 API서버에게 요청하는 역할

### API Server

쿠버네티스의 모든 구성요소와의 상호작용을 처리하고 상태변경이 있을 경우 etcd에 반영하는 역할

### etcd

쿠버네티스 클러스터의 모든 상태정보가 저장되는 키-값 형태의 스토리지 시스템

### Control Manager

쿠버네티스 클러스터의 다양한 컨트롤러를 관리하는 역할로써, 각 컨트롤러는 주기적으로 API서버를 통해 클러스터의 상태를 조회하며 현재 상태와 원하는 상태를 비교합니다.
만약 두 상태가 일치하지 않는 경우 원하는 상태와 일치시키기 위해 API서버를 통해 etcd에 상태를 반영하도록 합니다.

### Scheduler

주기적으로 클러스터의 상태를 조회하여 생성된 파드의 요구사항을 고려하여 가장 적합한 노드를 선택하고 API서버를 통해 etcd에 반영하도록 하는 역할

### kubelet

워커노드에서 실행되는 에이전트로써, API Server를 통해 주기적으로 자신에게 할당된 파드의 명세를 받아오고 이를 기반으로 노드의 상태와 파드의 생명주기를 관리합니다.
또한, 실행된 컨테이너의 상태정보를 주기적으로 API Server에게 알려주고 상태를 업데이트하도록 합니다.
